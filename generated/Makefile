# **NOTE**: this file is generated by `dhall-render`.
# You should NOT edit it manually, your changes will be lost.

SHELL = bash
.SHELLFLAGS = -eu -o pipefail -xc
.ONESHELL:

.SILENT: ci
.PHONY: ci
ci: render lint
	

.SILENT: digest
digest:
	dhall --ascii --plain --file package.dhall
	dhall --ascii --plain --file dhall/files.dhall
	dhall --ascii --plain --file Meta/package.dhall

.SILENT: eval
.PHONY: eval
eval:
	dhall --ascii --plain --file "package.dhall" > /dev/null
	dhall --ascii --plain --file "dhall/files.dhall" > /dev/null
	dhall --ascii --plain --file "Meta/package.dhall" > /dev/null

.SILENT: format
.PHONY: format
format:
	dhall --ascii --plain --file "package.dhall" > /dev/null
	dhall --ascii format --transitive "package.dhall"
	dhall --ascii --plain --file "dhall/files.dhall" > /dev/null
	dhall --ascii format --transitive "dhall/files.dhall"
	dhall --ascii --plain --file "Meta/package.dhall" > /dev/null
	dhall --ascii format --transitive "Meta/package.dhall"

.SILENT: format-only
.PHONY: format-only
format-only:
	dhall --ascii format --transitive "package.dhall"
	dhall --ascii format --transitive "dhall/files.dhall"
	dhall --ascii format --transitive "Meta/package.dhall"

.SILENT: lint
.PHONY: lint
lint:
	dhall --ascii --plain --file "package.dhall" > /dev/null
	dhall --ascii lint --transitive "package.dhall"
	dhall --ascii --plain --file "dhall/files.dhall" > /dev/null
	dhall --ascii lint --transitive "dhall/files.dhall"
	dhall --ascii --plain --file "Meta/package.dhall" > /dev/null
	dhall --ascii lint --transitive "Meta/package.dhall"

.SILENT: freeze
.PHONY: freeze
freeze:
	dhall --ascii --plain --file "package.dhall" > /dev/null
	dhall --ascii lint --transitive "package.dhall"
	dhall --ascii --plain --file "dhall/files.dhall" > /dev/null
	dhall --ascii lint --transitive "dhall/files.dhall"
	dhall --ascii --plain --file "Meta/package.dhall" > /dev/null
	dhall --ascii lint --transitive "Meta/package.dhall"

.SILENT: render
.PHONY: render
render:
	dhall/render

.SILENT: bump
.PHONY: bump
bump:
	set +x
	if ! git --no-pager diff --patch --exit-code --; then
	  echo >&2 'You have working changes, add or commit them first'
	  exit 1
	fi
	function bump {
	  echo
	  echo "Applying bump: $$1"
	  originalHashes=''
	  finalHashes=''
	  originalHashes+="$$(dhall hash --file "package.dhall")"
	  originalHashes+="$$(dhall hash --file "dhall/files.dhall")"
	  originalHashes+="$$(dhall hash --file "Meta/package.dhall")"
	  cp "dependencies/Workflow.dhall"{,.orig}
	  cp "dhall/dependencies/CI.dhall"{,.orig}
	  dhall/bump --to "$$1" --freeze-cmd="dhall --ascii freeze --inplace" --allow-unused dependencies/Workflow.dhall dhall/dependencies/CI.dhall
	  finalHashes+="$$(dhall hash --file "package.dhall")"
	  finalHashes+="$$(dhall hash --file "dhall/files.dhall")"
	  finalHashes+="$$(dhall hash --file "Meta/package.dhall")"
	  if [ "$$originalHashes" = "$$finalHashes" ]; then
	    mv "dependencies/Workflow.dhall"{.orig,}
	    mv "dhall/dependencies/CI.dhall"{.orig,}
	    echo "  [Reverting bump: $$1"]
	  else
	    rm "dependencies/Workflow.dhall".orig
	    rm "dhall/dependencies/CI.dhall".orig
	    echo "Applied: $$1"
	  fi
	}
	bump "timbertson/dhall-ci:"
	bump "timbertson/dhall-ci-git:"
	bump "timbertson/dhall-ci-dhall:"
	bump "timbertson/dhall-ci-docker:"
	bump "timbertson/dhall-render:"

.SILENT: docs
.PHONY: docs
docs:
	dhall-docs --ascii --input "." --output-link "docs"
